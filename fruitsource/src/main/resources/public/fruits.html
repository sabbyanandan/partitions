<head>

    <style>
        .math {
            position: fixed;
            width: 96%;
            text-align: center;
            font-size: 30px;
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            bottom: 50px;
        }

    </style>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load("current", {packages: ["corechart"]});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            var data = google.visualization.arrayToDataTable([
                ['ID', 'Group', 'Counter', 'Color'],
                ['Apple', -2, 0, 'apple'],
                ['Orange', -2, 0, 'orange'],
                ['Pineapple', -2, 0, 'pineapple'],
                ['Cherry', -2, 0, 'cherry'],
                ['Peach', -2, 0, 'peach']
            ]);

            var appleCounter = 0;
            var orangeCounter = 0;
            var pineappleCounter = 0;
            var cherryCounter = 0;
            var peachCounter = 0;
            var currentInstanceCount = 0;

            var ws = new WebSocket("ws://localhost:9292/websocket");
            ws.onopen = function () {
                console.log("Websocket connection open ...");
            };
            ws.onmessage = function (evt) {

                var received_msg = JSON.parse(evt.data);

                console.log("Message received! Fruit = " + received_msg.name + " | App Instance = " + received_msg.appInstance);

                if (received_msg.name === 'apple') {
                    appleCounter = ((appleCounter === 0) ? 1 : ++appleCounter);
                    data.setValue(0, 1, received_msg.appInstance);
                    data.setValue(0, 2, appleCounter);
                } else if (received_msg.name === 'orange') {
                    orangeCounter = ((orangeCounter === 0) ? 1 : ++orangeCounter);
                    data.setValue(1, 1, received_msg.appInstance);
                    data.setValue(1, 2, orangeCounter);
                } else if (received_msg.name === 'pineapple') {
                    pineappleCounter = ((pineappleCounter === 0) ? 1 : ++pineappleCounter);
                    data.setValue(2, 1, received_msg.appInstance);
                    data.setValue(2, 2, pineappleCounter);
                } else if (received_msg.name === 'cherry') {
                    cherryCounter = ((cherryCounter === 0) ? 1 : ++cherryCounter);
                    data.setValue(3, 1, received_msg.appInstance);
                    data.setValue(3, 2, cherryCounter);
                } else if (received_msg.name === 'peach') {
                    peachCounter = ((peachCounter === 0) ? 1 : ++peachCounter);
                    data.setValue(4, 1, received_msg.appInstance);
                    data.setValue(4, 2, peachCounter);
                }

                chart.draw(data, options);
                performModuloOps(received_msg.instanceCount);

//                console.log("Message received! Fruit = " + received_msg.name + " | App Instance = " + received_msg.appInstance);
            };

            var options = {
                title: 'Application Instance Group vs. Fruit Bucket',
                vAxis: {baseline: 10, title: 'Fruit Count in the Bucket'},
                colorAxis: {colors: ['yellow', 'red']},
                hAxis: {minValue: -1, maxValue: 2, title: 'Application Instance Group'},
                bubble: {
                    textStyle: {
                        fontSize: 12,
                        fontName: 'Times-Roman',
                        color: 'green',
                        bold: true,
                        italic: true
                    }
                }
            };

            var chart = new google.visualization.BubbleChart(document.getElementById('appPartitionCntr'));
            chart.draw(data, options);

                function performModuloOps(instanceCount) {
                // if (currentInstanceCount !== instanceCount) {
                //     instanceCount = 3;
                //     currentInstanceCount = instanceCount;
                //     var mathCntr = document.getElementById('mathCntr');
                    mathCntr.innerHTML = "<strong>The Math for [" + instanceCount + "] App Instances<br /><br /></strong>" +
                            " Apple will land at: " + 0 % instanceCount + " <i>[ie: 0 % " + instanceCount + "]</i> <br />" +
                            " Orange will land at: " + 1 % instanceCount + " <i>[ie: 1 % " + instanceCount + "]</i> <br />" +
                            " Pineapple will land at: " + 2 % instanceCount + " <i>[ie: 2 % " + instanceCount + "]</i> <br />" +
                            " Cherry will land at: " + 3 % instanceCount + " <i>[ie: 3 % " + instanceCount + "]</i> <br />" +
                            " Peach will land at: " + 4 % instanceCount + " <i>[ie: 4 % " + instanceCount + "]</i> <br />";
                // }
            }
        }
    </script>
</head>
<body>
<div id="appPartitionCntr" style="width: 100%; height: 600px;"></div>
<div id="mathCntr" class="math"></div>
</body>
</html>